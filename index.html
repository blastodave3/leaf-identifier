<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Leaf Identifier</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ml5@0.12.2/dist/ml5.min.js"></script>
    <style>
        body { 
            font-family: -apple-system, sans-serif; 
            text-align: center; 
            background: #121212; 
            color: #e0e0e0; 
            margin: 0; padding: 20px; 
        }
        #canvas-container { 
            margin: 20px auto; 
            border: 4px solid #2e7d32; 
            border-radius: 15px; 
            overflow: hidden; 
            display: inline-block;
            background: #000;
        }
        .status-box { background: #263238; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        button { 
            padding: 16px 32px; background: #4caf50; color: white; 
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>Tree ID</h2>
    <div class="status-box"><span id="status">Loading AI Model...</span></div>
    <div id="canvas-container"></div>
    <div id="ui-controls">
        <button id="start-btn" onclick="startCamera()">TAP TO START CAMERA</button>
    </div>

    <script>
      https://teachablemachine.withgoogle.com/models/2VPpeAyf2/
        let classifier, video, label = "Ready...", confidence = "", modelLoaded = false;

        function preload() {
            // Ensure the URL has the model.json suffix
            classifier = ml5.imageClassifier(imageModelURL + 'model.json', () => {
                modelLoaded = true;
                document.getElementById('status').innerText = "AI Model Ready!";
            });
        }

        function setup() {
            let canvas = createCanvas(320, 280);
            canvas.parent('canvas-container');
            background(0);
        }

        function startCamera() {
            // RECENT CHANGE: Standard Desktop Constraints
            let constraints = {
                video: true, // Simple "true" works best for desktop webcams
                audio: false
            };

            // Using p5.js createCapture
            video = createCapture(constraints, function(stream) {
                console.log("Webcam active on Desktop");
                document.getElementById('start-btn').style.display = 'none';
                document.getElementById('status').innerText = "AI is Scanning...";
                classifyVideo();
            });

            // ERROR HANDLING: If the camera fails, show us why
            video.elt.onloadedmetadata = () => console.log("Camera metadata loaded");
            video.elt.onerror = (err) => {
                document.getElementById('status').innerText = "Error: " + err.target.error.message;
            };

            video.size(320, 240);
            video.hide();
        }

        function classifyVideo() {
            if (modelLoaded && video) {
                classifier.classify(video, gotResult);
            }
        }

        function gotResult(error, results) {
            if (error) return;
            if (results && results[0]) {
                label = results[0].label;
                confidence = floor(results[0].confidence * 100) + "%";
            }
            classifyVideo();
        }

        function draw() {
            background(0);
            if (video) {
                image(video, 0, 0, 320, 240);
                fill(46, 125, 50);
                rect(0, 240, 320, 40);
                fill(255);
                textSize(18);
                textAlign(CENTER, CENTER);
                text(label + " " + confidence, width / 2, 260);
            }
        }
    </script>
</body>
</html>
